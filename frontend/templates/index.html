{% extends "base.html" %}
{% block title %}Главная — Notes{% endblock %}

{% block content %}
<h1>Пользователи</h1>

<table class="table">
  <thead>
    <tr>
      <th>Имя</th>
      <th>Email</th>
      <th>Заметок</th>
      {% if user and user.id %}
        <th>Действия (админ)</th>
      {% endif %}
    </tr>
  </thead>
  <tbody>
    {% for u in users %}
      <tr>
        <td>{{ u.name }}</td>
        <td class="muted">{{ u.email }}</td>
        <td>{{ u.notes_count }}</td>
        {% if user and user.id %}
        <td>
          {% if user.is_admin %}
            <a href="/admin/users/{{ u.id }}/notes">Заметки</a> |
            <a href="/admin/users/{{ u.id }}/edit">Изменить</a> |
            <form method="post" action="/admin/users/{{ u.id }}/delete" style="display:inline;" onsubmit="return confirm('Удалить пользователя и все его заметки?');">
              <button type="submit">Удалить</button>
            </form>

          {% elif user.id == u.id %}
            <a href="/notes">Заметки</a> |
            <a href="/me/edit">Изменить данные</a> |
            <form method="post" action="/me/delete" style="display:inline;" onsubmit="return confirm('Удалить аккаунт и все заметки?');">
              <button type="submit">Удалить себя</button>
            </form>
          {% else %}
            <!-- нет действий для чужих пользователей -->
          {% endif %}
        </td>
        {% endif %}


      </tr>
    {% endfor %}
  </tbody>
</table>

{% if not users %}
  <p class="small">Пользователей пока нет.</p>
{% endif %}
{% endblock %}
